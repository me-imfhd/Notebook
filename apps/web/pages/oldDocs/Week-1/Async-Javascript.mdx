
# Async, await, callbacks, promises


> ‚≠ê Due to DRM encryption on 100xdev, screenshots taken turn out black.


## Recap


---


Consider three tasks below

1. Teach (Takes 1 hr)
2. Buy iPad (Takes 1hr)
3. Cook Dinner (Takes 1 hr)

**In Synchronous way**, I alone will do 3 tasks sequentially. One by One. Thus, **took 3 Hours**.


**In an Asynchronous way**, I teach and meanwhile told my brother to buy an iPad and sister to cook dinner. Thus, it **took  1 hour**.


```javascript
// Code for stopwatch

var counter = 1;

function printCounter(){
  **console.clear();**
  console.log(counter);
  counter = counter+1;
}

setInterval(printCounter, 1000);
```


## JS Runtime/Event Loop


---


**Event Loop** is a way of running asynchronous code (background task) in JavaScript. 


An async code is offloaded to ‚Äú**Web APIs**‚Äù, (which is on _separate thread_) or so it keeps running in background and doesn't block the _main thread_. When this background task is completed, its callback is added to a ‚Äú**Callback Queue**‚Äù and is pushed to ‚Äú**Call Stack**‚Äù(when it is empty) by ‚Äú**Event Loop**‚Äù and hence that callback executes on main thread.


[Screen_Recording_2023-06-18_at_4.26.16_PM.mov](https://prod-files-secure.s3.us-west-2.amazonaws.com/dd624914-6876-4b58-9694-424f7aa5e22a/7fd59fa2-4733-45a3-9fbc-3c794406bad3/Screen_Recording_2023-06-18_at_4.26.16_PM.mov?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240206%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240206T002322Z&X-Amz-Expires=3600&X-Amz-Signature=cc267eee4d6322c1a080b5d08b78c2c267f9eb5b1e0bbf8c576889bdb83ad858&X-Amz-SignedHeaders=host&x-id=GetObject)


In the code below, setTimeout, an async code, is offloaded to Web APIs, and its callback is pushed into in the callback queue when time ends. Its callback executes only when the Call Stack is empty or there is no long-running task.


```javascript
// The code used in above demonstration.

var counter = 1;

function printCounter(){
  console.clear();
  console.log(counter);
  counter = counter+1;
}

setTimeout(printCounter, 3000);

var counter = 0;
for(var i = 0; i < 3; i++){
    counter = counter + i;
}
```


> ‚≠ê Web API runs on a separate thread for async/background task, while the JS thread is for main task.


**Additional Resources**


[bookmark](https://youtu.be/EI7sN1dDwcY)


[bookmark](https://youtu.be/8aGhZQkoFbQ)


## Callback & Promises


---


**Callback** : When we want to call a function after a task finishes. Like I want my friend to get Medicine2 once I receive the Medicine1 from him. Below is the code for the same.


```javascript
function getMedicine1(){
	console.log("1 Received");
	setTimeout(getMedicine2, 2000);
}

function getMedicine2(){
	console.log("2 Received");
}

setTimeout(getMedicine1, 1000);
```


**Callback Hell** : When the code above is written like below, this usually happens in complex code, which too much nested. This super ugly code is referred to as ‚ÄúCallback Hell‚Äù.


```javascript
setTimeout(function getMedicine1(){
 console.log("1 Received");
  setTimeout(function getMedicine2(){
	console.log("2 Received"); 
  }, 2000);
}, 1000);
```


**Promises** : In the solution to callback hell, promises were introduced.


```javascript
function getMedicine1() {
  return new Promise(function(resolve, reject) {
    setTimeout(function() {
      console.log("1 Received")
      resolve();
    }, 1000);
  });
}

function getMedicine2() {
  return new Promise(function(resolve, reject) {
    setTimeout(function() {
			console.log("2 Received")
      resolve();
    }, 2000);
  });
}

getMedicine1()
	.then(getMedicine2())
```


**Another Promise example :** Simulating an Asynchronous Operation (e.g., making an API request)


```javascript
const fetchData = new Promise((resolve, reject) => {
  setTimeout(() => {
    const data = { name: "John Doe", age: 25 };
    resolve(data); }
  , 2000);
});

fetchData
  .then((result) => {
    console.log("Data fetched:", result);
  })
  .catch((error) => {
    console.error("Error:", error);
  });
```


> üëáüèª Summarization of **Callback** and **Promise**


**Callbacks**: Function provided to be called back when task completes.



**Promises**: Immediate promise received, allowing chaining of functions based on fulfilment or rejection.


```javascript
function printContent(error, data) {
	console.log(data);
}

fs.read("file.txt", printContent) // Callback Version
fs.read("file.txt").then(printContent) // Promise Version
```


## Async / Await


---


This is covered in Backend ‚Äì Database & Authentication


[Auth and Database](https://www.notion.so/6a19033486e543ca83a9c992fe81542f) 

