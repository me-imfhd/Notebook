
---


# Finishing Backend, Starting Frontend


## Quick Recap


---


**Where we are.**


HTTP Servers, Middleware were covered in previous classes, will be continuing on Databases and Authentication.


![Screenshot_2023-06-25_at_6.38.19_AM.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4dd32e22-0b9d-4863-baa0-84dfdaf49ec9/138e5691-1ea5-4ec9-9519-e23c0820cd33/Screenshot_2023-06-25_at_6.38.19_AM.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240117%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240117T214808Z&X-Amz-Expires=3600&X-Amz-Signature=e89a631f67b42da06d67f9434d522446f16d0f1464c03f4f982f45b3bef4938d&X-Amz-SignedHeaders=host&x-id=GetObject)


**Arrow Functions** : Another way to write functions.


```javascript
**// Typical way, what we are familiar with**

**function callback(err, data){
	console.log(data);
}**
fs.readFile('a.txt', 'utf-8', callback)
```


```javascript
**// Defining/Putting the same function inside.**

fs.readFile('a.txt', 'utf-8', **function (err, data){
	console.log(data);
}**)
```


```javascript
**// Arrow function, the modern and clean way.**

fs.readFile('a.txt', 'utf-8', **(err, data) => {
	console.log(data);
}**)
```


**Detailed difference between Arrow function vs Normal Function [ ADVANCE & EXTRA ]**

1. **Syntax** : In arrow function, an arrow,  `=>`  is used.

```javascript
**// Normal function**
function greet(name) {
  console.log("Hello, " + name + "!");
}

**// Arrow function**
const greetArrow = name => console.log("Hello, " + name + "!");

greet("John");           **// Output: Hello, John!**
greetArrow("John");      **// Output: Hello, John!**
```

1. **Binding of** `this`  **:** An arrow function within an object does not bind its own this value, instead inherit the `this` value from the enclosing context.

```javascript
**// Normal function**
const person = {
  name: "John",
  greet: function() {
    console.log("Hello, " + this.name + "!");
  }
};

person.greet();   **// Output: Hello, John!**

**// Arrow function**
const personArrow = {
  name: "John",
  greet: () => {
    console.log("Hello, " + this.name + "!");
  }
};

personArrow.greet();   **// Output: Hello, undefined!**
```

1. **Use of** **`arguments`** **:** arguments object is not available within arrow functions. Instead, you can use the rest parameter syntax (...args) to capture all the arguments passed to the arrow function.

```javascript
**// Normal function**
function **sum()** {
  let total = 0;
  for (let i = 0; i < **arguments**.length; i++) {
    total += arguments[i];
  }
  return total;
}

console.log(sum(**1, 2, 3**));      // Output: 6

**// Arrow function**
const sumArrow = **(...args)** => {
  let total = 0;
  for (let i = 0; i < **args**.length; i++) {
    total += args[i];
  }
  return total;
};

console.log(sumArrow(**1, 2, 3**)); // Output: 6
```

1. **Constructor** : Arrow functions can’t be used as constructor to create new object.

```javascript
**// Normal function**
function Person(name) {
  this.name = name;
}

**const john = new Person("John");**
console.log(john.name);   // Output: John

**// Arrow function (as constructor)**
const PersonArrow = name => {
  this.name = name;
};

**const johnArrow = new PersonArrow("John");**  // Throws TypeError: PersonArrow is not a constructor
```

1. **Event Handling**

```javascript
const button = document.querySelector("button");

button.addEventListener("click", function() {
  console.log(this);   **// Refers to the button element**
});

const buttonArrow = document.querySelector("button");

buttonArrow.addEventListener("click", () => {
  console.log(this);   **// Refers to the Window (global object)**
});
```


## Foundation for databases


---


> ⚠️ On storing todos/data in variable like `var` , is essentially storing in memory, if process/server/computer restarts, all data is lost.


**Storing Todos in a file**


`fs.readFile()`  returns a string like this, for example  `" [ { title : "Buy Groceries" } ] "` but we need an object, so to convert into “object type” we use `JSON.parse()`


```javascript
fs.readFile("todos.json", "utf8", (err, data) => {
    if (err) throw err;
    res.json(JSON.parse(data));
});
```


`fs.writeFile()` accepts only string as a type to write to a file, so we need to convert it into string using `JSON.stringify()`  


```javascript
fs.writeFile("todos.json", JSON.stringify(todos), (err) => {
      if (err) throw err;
      res.status(201).json(newTodo);
});
```


> 💡 Writing data to file makes it persistent or didn’t lost on server restart, but this is not efficient way to do. So we have databases for storing data that gives superman powers.


## Connecting frontend to backend


---


**CORS** (Cross-Origin Resource Sharing)

Browsers by default implements the **Same-Origin Policy**, according to which they only allow the data to be fetched from its own URL, like **`google.com`** can only request data from **`google.com`** 


> 💡 Same Origin Policy : Allows Request URL = Response URL


We have to implement CORS, to request a data from website/URL other than its own URL, like **`google.com`** want to request data from **`facebook.com`** . 


> 💡 CORS : Allows Request URL ≠ ResponseURL


**CORS Error Demonstration** : In the image below I am trying to access the resource from URL other than my own, `http://localhost:3000/todos`  . By default browsers allow Same Origin Policy, so it gets blocked.


![Screenshot_2023-06-26_at_1.37.39_PM.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4dd32e22-0b9d-4863-baa0-84dfdaf49ec9/f8380193-94d2-4414-b82b-4946b3b5769c/Screenshot_2023-06-26_at_1.37.39_PM.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240117%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240117T214808Z&X-Amz-Expires=3600&X-Amz-Signature=c47d233fa5a0b5f30c11f40bb054dd7250e57d8f4f2ea67dd21161e41344b1c0&X-Amz-SignedHeaders=host&x-id=GetObject)


**CORS Error Solution** : Serving frontend and backend from same URL. Here From `http://localhost:3000/` at `/` route, fetching the html page, and fetching the todos from `http://localhost:3000/todos` , hence no origin mismatch.


![Screenshot_2023-06-26_at_1.59.00_PM.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4dd32e22-0b9d-4863-baa0-84dfdaf49ec9/4370311c-038a-4001-b885-5569ff2ef32c/Screenshot_2023-06-26_at_1.59.00_PM.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240117%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240117T214808Z&X-Amz-Expires=3600&X-Amz-Signature=7337bdb41b4351828a18d1e5b305fbcea6df9455fcea949c63a0764da3b43b42&X-Amz-SignedHeaders=host&x-id=GetObject)


**Another solution** : `npm install cors` in sever and write the code below


```css
const cors = require('cors')
app.use(cors())
```


**CORS Working and Headers [ ADVANCE & EXTRA ]**


CORS works by adding specific HTTP headers to the server's responses. When a browser receives a response from a server that includes these CORS headers, it determines whether to allow or block the response based on the requested origin and the server's configured CORS policy.


CORS-related HTTP headers

1. **Access-Control-Allow-Origin**: Specifies which origins are allowed to access and "*" to allow any origin.
2. **Access-Control-Allow-Methods**: Specifies the HTTP methods (e.g., GET, POST, PUT, DELETE) that are allowed.
3. **Access-Control-Allow-Headers**: This header lists the headers that are allowed to be included in the request.
4. **Access-Control-Allow-Credentials**: This header indicates whether the server allows credentials (such as cookies, HTTP authentication, or client-side SSL certificates) to be sent with the cross-origin request.
5. **Access-Control-Max-Age**: Specifies the maximum time (in seconds) that the browser should cache the preflight response.

> 💡 **Simple requests**: For simple requests (GET or POST), the browser directly sends the request to the server, adding **`Origin`** 


> 💡 **Preflight requests**: For more complex requests (PUT, DELETE), the browser first sends a preflight request (OPTIONS) to the server. The preflight request serves as a "permission request". Its like asking server do we have permission for the requests.


**Reference Resource**


[bookmark](https://youtu.be/4KHiSt0oLJ0)


[bookmark](https://youtu.be/PNtFSVU-YTI)

